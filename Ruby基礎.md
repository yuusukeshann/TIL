# Ruby基礎


## それぞれの変数のスコープ、実用例

### ◆クラス変数  @@変数名 = xxxx  
  ・ クラス定義内・クラスメソッド内・initializeメソッド内・インスタンスメソッド内でも定義できる。    

  ・ インスタンス変数とは違い、同一インスタンスはもちろん、異なるインスタンスやクラスでの呼び出しでも更新などした値は共有される。  
  したがって、どちらも引数を渡して２つのインスタンスを作成し、どちらも別の名前でインスタンス名を定義してもクラス変数が同じ名前なら値は共有されているので２回目に渡した引数を呼び出す。  

  ・ インスタンス変数（正確にいうとインスタンスメソッド）とは違い、インスタンスを生成(クラス名.new)しなくても利用可能。  

  * スコープ  
  クラス定義内・クラスメソッド内・initializeメソッド内・インスタンスメソッド内のどこでも更新、参照可能。  
  クラスを超えた参照はできない。（継承すればできる。）

  * 実用例



<br>
<br>

### ◆ インスタンス変数  @変数名 = xxxx   
  ・インスタンスメソッド内かinitializeメソッド内で定義できる。

  ・@属性名 = 属性値(値)、または「データ」とも言い換えることができる。


  ・クラス定義内で定義するとクラスインスタンス変数という別の変数になり動作が異なる。  

  ・インスタンスごとに独立した変数となることが特徴で、例えば０から始まり呼び出すごとに＋１される「sampleと言う一つの変数」を記述した「一つのメソッド」があるとする。  
  その一つのメソッドを「a」「b」という名でそれぞれインスタンスを作成し、aの後にbのインスタンスを作成しても同じメソッドを呼び出してはいるが、それぞれ別のインスタンスと見做されるのでaは1、bは2ではなく、
  最初はaもbも１と１、２回目は２と２...となる。

  ・initializeメソッドやインスタンスメソッド内に記述したインスタンス変数はそれらのメソッドを呼び出すことで利用する(呼び出す)ことができる。


  * スコープ  
  インスタンスメソッド内かinitializeメソッド内で更新、参照可能。


  * 実用例
  


<br>
<br>

### ◆ ローカル変数  変数名 = xxxx   
  ・定義するのはどこでも可能。

  * スコープ  
  変数を定義した位置から、その変数が定義されたブロック、メソッド、クラス/モジュール定義の終わりまで。  
  each do ~ endブロック、times do ~ endブロックなどで定義された変数はブロック外では使えない。  
  メソッド内で定義した変数(info_method)は  
  同じクラス内でもその定義したメソッド外（クラス内の他のメソッド内）では使えず、  
  逆も同様に、メソッド外で定義した変数はメソッド内で使えない。  
  違う言い方をするならインスタンスメソッド内で定義したローカル変数は、違うインスタンスメソッドやクラスメソッド内でも使えない。 


  * 実用例





<br>
<br>

### ◆ クラスインスタンス変数  @変数名 = xxxx   
  ・ クラスオブジェクトのインスタンス変数のこと。  
  ・ 見た目はインスタンス変数と全く同じだが、定義する場所が異なっており、クラス定義内かクラスメソッド内で定義する。(インスタンスメソッド、もしくはinitializeメソッド内で定義するとインスタンス変数となる)  
  ・クラス変数との違いは、クラスを継承したクラスではその変数にアクセスできない、インスタンスメソッドやinitializeメソッドから利用できない。  
  ・ インスタンス変数とは違い、インスタンスの作成(クラス名.new)しなくても利用可能。


  * スコープ  
  ・クラス定義内、もしくはクラスメソッド内で参照・更新ができる。


  * 実用例




### ◆ グローバル変数  ＄変数名 = xxxx   
  プログラムのどこからでも参照、更新が可能。

  * スコープ  
  プログラムのどこからでも参照、更新が可能。


  * 実用例




<br>
<br>


## それぞれのメソッドのスコープ、実用例


### クラスメソッド

クラスメが利用できるメソッドでクラス全体に関わるデータの変更・参照を行う際に使うメソッド。  
クラスで共通の情報を使った処理に使用

・ インスタンスメソッドとは違い、インスタンスの作成(クラス名.new)しなくても利用（呼び出し）可能。  
クラスメソッドをインスタンスから呼び出すことはできない。

・クラスメソッドは初期値を設定できないので初期値が不要なケースで利用する。


* 書き方  
  * self.クラスメソッド名

  * class << self
    def クラスメソッド名
      処理
    end


* 呼び出し方  
クラス名.メソッド名

* メモ  
クラスメソッドをprivateにすると、クラスメソッドをそのクラス内でしか呼び出せないようにできる。

また、private_class_methodを使うことで、クラスやモジュールのクラスメソッドをprivateなメソッドに変更することができる。


<br>
<br>

### インスタンスメソッド  
インスタンスが利用できるメソッドで、  
個別のインスタンスに関わる情報を変更したり、参照したりするメソッドを作成するときなど、インスタンス毎で挙動を制御したい場合に使用する

直接アクセスすることはできず、インスタンスを生成した上で、インスタンスを介してアクセスすることができます。

* 呼び出し方   
インスタンス名 = クラス名.new  
でインスタンスを生成してから  
インスタンス名.メソッド名  


<br>
<br>

### クラスメソッドとインスタンスメソッドの違い、使い分け


* インスタンスを引数なしでnewした直後に何かメソッドを呼び出している場合は、それはクラスメソッドの候補

* インスタンス変数を使う必要がない場合

* インスタンスメソッドでできることをクラスメソッドで試してみた結果、記述が煩雑にはり引数が多くなった。  
引数があるよりは、ない方が良い。引数がなければ、そもそも何を情報として渡さなければいけないかを考えなくていいのでコードを使う人に余計な仕事を増やさない。

  そういったことからクラスメソッドとインスタンスメソッドの使い分け、というよりは、まずインスタンスメソッドで実現できないか？を考えるべき。


* どのようなときにクラスメソッドを用いれば良いのか？

一例だが多いのは「外部からデータを取得する処理」。

DBからデータを読みだして、新たにインスタンスを生成する時  
ファイルからデータを読みだして、新たにインスタンスを生成する時  
オブジェクトを参照して、新たにインスタンスを生成する時  


<!-- また、Rubyを使っている方ならattr_accessorといった、クラスの定義に直接記載するコードを見たことがあると思います。このようなコードはクラスアノテーションと呼ばれています。このクラスアノテーションを実現するためには、クラスメソッドとして定義する必要があります。 -->

もしくは、全くデータを持たないクラスを設計するとき。しかし、こういった場合Rubyではモジュールという機能を使う方が自然。


<br>
<br>

### initializeメソッド(コンストラクタとも言う)
インスタンスの生成をした時に必ず実行されるメソッド。

インスタンス共通で使用するための空の配列を用意したり、引数で渡された値を変数化しておく、などといったインスタンス内のメソッドで利用するための準備のためのアクションをさせることに使用される。  
それらを初期化と言ったりする？  

initializeメソッドは、複数定義しても意味がなく、複数定義した場合は最後に記述した方が有効になる。
しかし、継承し新しく定義したクラスでなら上書きできる。


* 書き方 
  def initialize()
    処理
  end

* 呼び出し方   
インスタンス名 = クラス名.new  

<br>
<br>




### スーパークラス  
Rubyでは各要素の型にはクラスがあり、そのクラスの親となっているクラスのことをスーパークラスと言う。（上の階層のクラスのこと）  
または、クラスを継承する時元となるクラスのことをスーパークラス（親クラス、基底クラス）と呼び、継承によりスーパークラスを受け継ぐクラスのことをサブクラス（子クラス、派生クラス）と言う。

スーパークラスの例  
整数「１」のクラス（型）は「Integer」。  
「Integer」のスーパークラスは、数字全般を表す「Numeric」。  
「Numeric」のスーパークラスは、データ全般を表す「Object」。  
「Object」のスーパークラスは、識別やメソッドの指定など基本機能だけをもつ「BasicObject」。これが最上位のクラス。  

クラスの構造を図にすると以下のようになる。  

  BasicObject（最上位のクラス）  
    ↓   
  Object  
    ↓  
  String, Numeric, Module, Class,,,  
    ↓  
  Integer, Float  


* 主要な要素とその型(クラス)とそのスーパークラス


| 要素                     | 型（クラス)      | スーパークラス    |
| ----------------------- | --------------- | -------------- |
| “string”                | String          | Object         |
| 100                     | Integer         | Numeric        |
| 1.23                    | Float           | Numeric	       |
| [1, 2, 3]               | Array           | Object         |
| {:a=>1, :b=>2, :c=>3}	  | Hash            | Object         |
| クラス                   | Class Object    | Basic Object   |
| モジュール                | Module Object   | Basic Object   |
| nil                     | NilClass         | Object        |


